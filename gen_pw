#!/bin/bash

# Check for username argument
if [[ -z "$1" ]] ; then
	echo "Usage: $0 <username>"
	exit 1
fi

user="$1"

# Generate password
# pass=$(< /dev/urandom tr -dc 'A-Za-z0-9!@#$%^&*()_+-=' | head -c 20)

# Generate a password with stricter rules
gen_strong_pass() {
	local pw=""
	while true ; do
		pw=$(< /dev/urandom tr -dc 'A-Za-z0-9!@#$%^&*()_+-=' | head -c 20)
		[[ "$pw" =~ [A-Z] ]] && \
		[[ "$pw" =~ [a-z] ]] && \
		[[ "$pw" =~ [0-9] ]] && \
		[[ "$pw" =~ [\!\@\#\$\%\^\&\*\(\)_\+\-=] ]] && break
	done
	echo "$pw"
}

pass=$(gen_strong_pass)

# Output formatted username and password
echo "username: $user"
echo "temporary_password: $pass"

# Log credentials securely
logFile="/var/log/gen_pass.log"
echo "$(date '+%Y-%m-%d %H:%M:%S') | username: $user | temporary_password: $pass" | sudo tee -a "$logFile" > /dev/null
sudo chmod 600 "$logFile" 2>&1 /dev/null
